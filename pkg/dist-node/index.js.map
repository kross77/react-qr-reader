{"version":3,"file":"index.js","sources":["../dist-src/QrReader/styles.js","../dist-src/QrReader/helpers/utils.js","../dist-src/QrReader/helpers/image.js","../dist-src/QrReader/helpers/video.js","../dist-src/QrReader/helpers/cleanup.js","../dist-src/QrReader/hooks/useQrReader.js","../dist-src/QrReader/index.js"],"sourcesContent":["export default {\n  container: {\n    overflow: 'hidden',\n    position: 'relative',\n    width: '100%',\n    paddingTop: '100%'\n  },\n  hidden: {\n    display: 'none'\n  },\n  videoPreview: {\n    top: 0,\n    left: 0,\n    display: 'block',\n    position: 'absolute',\n    overflow: 'hidden',\n    width: '100%',\n    height: '100%',\n    objectFit: 'cover',\n    transform: undefined\n  }\n};","export const getDeviceId = async facingMode => {\n  let videoInputDevices = await navigator.mediaDevices.enumerateDevices();\n  videoInputDevices = videoInputDevices.filter(deviceInfo => deviceInfo.kind === 'videoinput');\n\n  if (videoInputDevices.length < 1) {\n    throw new Error('No video input devices found');\n  }\n\n  const regex = facingMode === 'environment' ? /rear|back|environment/gi : /front|user|face/gi;\n  const devices = await Promise.all(videoInputDevices.filter(videoDevice => regex.test(videoDevice.label)).map(async videoDevice => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          deviceId: {\n            exact: videoDevice.deviceId\n          }\n        }\n      });\n      stream.getVideoTracks().forEach(track => {\n        track.getCapabilities();\n        track.getSettings();\n      });\n      stream.getTracks().forEach(track => track.stop());\n      return {\n        deviceId: videoDevice.deviceId,\n        streamError: false\n      };\n    } catch (err) {\n      return {\n        deviceId: videoDevice.deviceId,\n        streamError: true\n      };\n    }\n  }));\n  const [device] = devices.filter(device => !device.streamError);\n\n  if (!device) {\n    throw new Error('No video input devices found');\n  }\n\n  return device.deviceId;\n};\nexport const decodeQR = ({\n  data,\n  width,\n  height\n}) => {\n  // eslint-disable-next-line no-restricted-globals\n  const decoded = self.jsQR(data, width, height, {\n    inversionAttempts: 'attemptBoth'\n  });\n\n  try {\n    return JSON.parse(decoded === null || decoded === void 0 ? void 0 : decoded.data);\n  } catch (err) {\n    return decoded === null || decoded === void 0 ? void 0 : decoded.data;\n  }\n};","export const getImageData = async ({\n  resolution,\n  preview,\n  canvas\n}) => new Promise(resolve => {\n  if (!preview || !canvas) {\n    resolve(null);\n  }\n\n  if (preview.readyState === preview.HAVE_ENOUGH_DATA) {\n    // Get image/video dimensions\n    let width = Math.floor(preview.videoWidth);\n    let height = Math.floor(preview.videoHeight); // Canvas draw offsets\n\n    let hozOffset = 0;\n    let vertOffset = 0; // Crop image to fit 1:1 aspect ratio\n\n    const smallestSize = width < height ? width : height;\n    const ratio = resolution / smallestSize;\n    height = ratio * height;\n    width = ratio * width;\n    vertOffset = (height - resolution) / 2 * -1;\n    hozOffset = (width - resolution) / 2 * -1;\n    canvas.width = resolution;\n    canvas.height = resolution;\n    const ctx = canvas.getContext('2d', {\n      alpha: false\n    });\n    ctx.imageSmoothingEnabled = false; // gives less blurry images\n\n    ctx.drawImage(preview, hozOffset, vertOffset, width, height);\n    const image = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    resolve(image);\n  } else {\n    resolve(null);\n  }\n});","import { getDeviceId } from \"./utils.js\";\nexport const getVideoStream = async ({\n  facingMode,\n  constraints,\n  resolution\n}) => {\n  var _navigator, _navigator2, _navigator2$mediaDevi;\n\n  // Check browser facingMode constraint support\n  // Firefox ignores facingMode or deviceId constraints\n  const isFirefox = /firefox/i.test((_navigator = navigator) === null || _navigator === void 0 ? void 0 : _navigator.userAgent);\n  const supportedConstraints = (_navigator2 = navigator) === null || _navigator2 === void 0 ? void 0 : (_navigator2$mediaDevi = _navigator2.mediaDevices) === null || _navigator2$mediaDevi === void 0 ? void 0 : _navigator2$mediaDevi.getSupportedConstraints();\n  const defaultConstraints = {\n    width: {\n      min: resolution\n    }\n  };\n\n  if (supportedConstraints !== null && supportedConstraints !== void 0 && supportedConstraints.facingMode) {\n    defaultConstraints.facingMode = {\n      ideal: facingMode\n    };\n  }\n\n  if (supportedConstraints !== null && supportedConstraints !== void 0 && supportedConstraints.frameRate) {\n    defaultConstraints.frameRate = {\n      ideal: 25,\n      min: 10\n    };\n  }\n\n  let video = null;\n\n  if (supportedConstraints.facingMode || isFirefox) {\n    video = constraints || defaultConstraints;\n  } else {\n    const deviceId = await getDeviceId(facingMode);\n    video = { ...{\n        deviceId\n      },\n      ...constraints\n    };\n  }\n\n  return await navigator.mediaDevices.getUserMedia({\n    video\n  });\n};\nexport const prepareVideoStream = async ({\n  preview,\n  stream\n}) => new Promise((resolve, reject) => {\n  try {\n    if (!preview || !stream) {\n      resolve();\n    }\n\n    window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n    if ('srcObject' in preview) {\n      preview.srcObject = stream;\n    } else if ('mozSrcObject' in preview) {\n      preview.mozSrcObject = stream;\n    } else {\n      preview.src = window.URL && window.URL.createObjectURL(stream) || stream;\n    } // IOS play in fullscreen\n\n\n    preview.setAttribute('playsInline', true);\n    resolve();\n  } catch (err) {\n    reject(err);\n  }\n});","export const clearPreview = preview => {\n  if (preview) {\n    preview.pause();\n    preview.mozSrcObject = null;\n    preview.srcObject = null;\n    preview.src = '';\n  }\n};\nexport const clearStreams = streams => {\n  const pc = new RTCPeerConnection();\n  streams.forEach(stream => {\n    if (stream.stop) {\n      // Legacy way for older browsers\n      stream.stop && stream.stop();\n      pc.addStream && pc.addStream(stream);\n    } else {\n      // New way for modern browsers\n      stream.getTracks().forEach(track => {\n        track.enabled = !track.enabled;\n        track.stop();\n        pc.addTrack(track, stream);\n      });\n    }\n  });\n};\nexport const clearFrames = cancelIds => {\n  cancelIds.forEach(window.cancelAnimationFrame);\n};","import { useWorker } from '@koale/useworker';\nimport { useEffect, useRef } from 'react';\nimport { decodeQR } from \"../helpers/utils.js\";\nimport { getImageData } from \"../helpers/image.js\";\nimport { getVideoStream, prepareVideoStream } from \"../helpers/video.js\";\nimport { clearFrames, clearPreview, clearStreams } from \"../helpers/cleanup.js\";\nconst JSQR = 'https://cdn.jsdelivr.net/npm/jsqr@1.2.0/dist/jsQR.min.js';\nexport const useQrReader = ({\n  callbacks: [onLoad, onScan, onError],\n  refs: [canvas, preview],\n  constraints,\n  facingMode,\n  resolution,\n  debug\n}) => {\n  const cancelIds = useRef([]);\n  const streams = useRef([]); // eslint-disable-next-line no-unused-vars\n\n  const [decodeQrImage, {\n    kill: clearWorker\n  }] = useWorker(decodeQR, {\n    remoteDependencies: [JSQR],\n    autoTerminate: false\n  });\n\n  const tryQrScan = async () => {\n    try {\n      const data = await getImageData({\n        preview: preview.current,\n        canvas: canvas.current,\n        resolution\n      });\n      debug && debug(data, 'raw_data');\n\n      if (!data) {\n        throw '[QrReader]: error while trying to decode value';\n      }\n\n      const decoded = await decodeQrImage(data);\n\n      if (typeof onScan === 'function') {\n        debug && debug(decoded, 'value');\n        onScan(decoded);\n      }\n    } catch (err) {\n      if (typeof onError === 'function') {\n        debug && debug(err, 'error');\n        onError(err);\n      }\n    } finally {\n      const cancelID = window.requestAnimationFrame(tryQrScan);\n      cancelIds.current.push(cancelID);\n    }\n  };\n\n  const initQrScan = async () => {\n    try {\n      const stream = await getVideoStream({\n        constraints,\n        resolution,\n        facingMode\n      });\n      streams.current.push(stream);\n      await prepareVideoStream({\n        preview: preview.current,\n        stream\n      });\n      await preview.current.play();\n\n      if (typeof onLoad === 'function') {\n        debug && debug(stream, 'load');\n        onLoad(stream);\n      }\n\n      const cancelID = window.requestAnimationFrame(tryQrScan);\n      cancelIds.current.push(cancelID);\n    } catch (err) {\n      if (typeof onError === 'function') {\n        debug && debug(err, 'error');\n        onError(err);\n      }\n    }\n  };\n\n  useEffect(() => {\n    const clearId = setTimeout(initQrScan, 500);\n    return () => {\n      clearWorker();\n      clearTimeout(clearId);\n      clearFrames(cancelIds.current);\n      clearPreview(preview.current);\n      clearStreams(streams.current);\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n};","import styles from \"./styles.js\";\nimport React, { useRef } from 'react';\nimport { useQrReader } from \"./hooks/useQrReader.js\";\nexport const QrReader = ({\n  constraints,\n  facingMode,\n  resolution,\n  ViewFinder,\n  className,\n  onError,\n  onScan,\n  onLoad,\n  style,\n  debug\n}) => {\n  const canvasRef = useRef(null);\n  const videoRef = useRef(null);\n  useQrReader({\n    callbacks: [onLoad, onScan, onError],\n    refs: [canvasRef, videoRef],\n    constraints,\n    facingMode,\n    resolution,\n    debug\n  });\n  return /*#__PURE__*/React.createElement(\"section\", {\n    className: className,\n    style: style\n  }, /*#__PURE__*/React.createElement(\"section\", {\n    style: styles.container\n  }, !!ViewFinder && /*#__PURE__*/React.createElement(ViewFinder, null), /*#__PURE__*/React.createElement(\"video\", {\n    muted: true,\n    ref: videoRef,\n    style: { ...styles.videoPreview,\n      transform: facingMode === 'user' && 'scaleX(-1)'\n    }\n  }), /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvasRef,\n    style: styles.hidden\n  })));\n};\nQrReader.displayName = 'QrReader';\nQrReader.defaultProps = {\n  resolution: 600,\n  constraints: null,\n  facingMode: 'environment'\n};\nexport default QrReader;"],"names":["container","overflow","position","width","paddingTop","hidden","display","videoPreview","top","left","height","objectFit","transform","undefined","getDeviceId","facingMode","videoInputDevices","navigator","mediaDevices","enumerateDevices","filter","deviceInfo","kind","length","Error","regex","devices","Promise","all","videoDevice","test","label","map","stream","getUserMedia","video","deviceId","exact","getVideoTracks","forEach","track","getCapabilities","getSettings","getTracks","stop","streamError","err","device","decodeQR","data","decoded","self","jsQR","inversionAttempts","JSON","parse","getImageData","resolution","preview","canvas","resolve","readyState","HAVE_ENOUGH_DATA","Math","floor","videoWidth","videoHeight","hozOffset","vertOffset","smallestSize","ratio","ctx","getContext","alpha","imageSmoothingEnabled","drawImage","image","getVideoStream","constraints","_navigator","_navigator2","_navigator2$mediaDevi","isFirefox","userAgent","supportedConstraints","getSupportedConstraints","defaultConstraints","min","ideal","frameRate","prepareVideoStream","reject","window","URL","webkitURL","mozURL","msURL","srcObject","mozSrcObject","src","createObjectURL","setAttribute","clearPreview","pause","clearStreams","streams","pc","RTCPeerConnection","addStream","enabled","addTrack","clearFrames","cancelIds","cancelAnimationFrame","JSQR","useQrReader","callbacks","onLoad","onScan","onError","refs","debug","useRef","decodeQrImage","kill","clearWorker","useWorker","remoteDependencies","autoTerminate","tryQrScan","current","cancelID","requestAnimationFrame","push","initQrScan","play","useEffect","clearId","setTimeout","clearTimeout","QrReader","ViewFinder","className","style","canvasRef","videoRef","React","createElement","styles","muted","ref","displayName","defaultProps"],"mappings":"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"}